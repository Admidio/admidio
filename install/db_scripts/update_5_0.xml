<?xml version="1.0" encoding="UTF-8"?>
<update>
    <step id="10">UPDATE %PREFIX%_preferences SET prf_value = '1' WHERE prf_name = 'photo_show_mode' AND prf_value = '0'</step>
    <step id="20">ALTER TABLE %PREFIX%_user_fields DROP COLUMN usf_description_inline</step>
    <step id="30">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'system_js_editor_color'</step>
    <step id="40">DELETE FROM %PREFIX%_menu WHERE men_name_intern = 'dbback'</step>
    <step id="50">DELETE FROM %PREFIX%_components WHERE com_name_intern = 'BACKUP'</step>
    <step id="60">UPDATE %PREFIX%_menu SET men_icon = 'house-door-fill' WHERE men_icon = 'fa-home'</step>
    <step id="70">UPDATE %PREFIX%_menu SET men_icon = 'newspaper' WHERE men_icon = 'fa-newspaper'</step>
    <step id="80">UPDATE %PREFIX%_menu SET men_icon = 'calendar-week-fill' WHERE men_icon = 'fa-calendar-alt'</step>
    <step id="90">UPDATE %PREFIX%_menu SET men_icon = 'file-earmark-arrow-down-fill' WHERE men_icon = 'fa-file-download'</step>
    <step id="100">UPDATE %PREFIX%_menu SET men_icon = 'envelope-fill' WHERE men_icon = 'fa-comments'</step>
    <step id="110">UPDATE %PREFIX%_menu SET men_icon = 'image-fill' WHERE men_icon = 'fa-image'</step>
    <step id="120">UPDATE %PREFIX%_menu SET men_icon = 'link-45deg' WHERE men_icon = 'fa-link'</step>
    <step id="130">UPDATE %PREFIX%_menu SET men_icon = 'person-vcard-fill' WHERE men_icon = 'fa-address-card'</step>
    <step id="140">UPDATE %PREFIX%_menu SET men_icon = 'people-fill' WHERE men_icon = 'fa-users'</step>
    <step id="145">UPDATE %PREFIX%_menu SET men_icon = 'list-stars' WHERE men_icon = 'fa-list-ul'</step>
    <step id="150">UPDATE %PREFIX%_menu SET men_icon = 'gear-fill' WHERE men_icon = 'fa-cog'</step>
    <step id="155">UPDATE %PREFIX%_menu SET men_icon = 'card-checklist' WHERE men_icon = 'fa-file-signature'</step>
    <step id="160">UPDATE %PREFIX%_menu SET men_icon = 'menu-button-wide-fill' WHERE men_icon = 'fa-stream'</step>
    <step id="165">UPDATE %PREFIX%_menu SET men_icon = 'book-half' WHERE men_icon = 'fa-book'</step>
    <step id="170">UPDATE %PREFIX%_user_fields SET usf_value_list = 'gender-male|SYS_MALE
gender-female|SYS_FEMALE
gender-trans|SYS_DIVERSE' WHERE usf_name_intern = 'GENDER' AND usf_value_list LIKE 'fa-mars|%'</step>
    <step id="180">UPDATE %PREFIX%_user_fields SET usf_icon = 'facebook' WHERE usf_name_intern = 'FACEBOOK'</step>
    <step id="190">UPDATE %PREFIX%_user_fields SET usf_icon = 'instagram' WHERE usf_name_intern = 'INSTAGRAM'</step>
    <step id="200">UPDATE %PREFIX%_user_fields SET usf_icon = 'linkedin' WHERE usf_name_intern = 'LINKEDIN'</step>
    <step id="210">UPDATE %PREFIX%_user_fields SET usf_icon = 'mastodon' WHERE usf_name_intern = 'MASTODON'</step>
    <step id="220">UPDATE %PREFIX%_user_fields SET usf_icon = 'skype' WHERE usf_name_intern = 'SKYPE'</step>
    <step id="230">UPDATE %PREFIX%_user_fields SET usf_icon = 'twitter-x' WHERE usf_name_intern = 'TWITTER'</step>
    <step id="240">UPDATE %PREFIX%_user_fields SET usf_icon = null WHERE usf_name_intern = 'XING'</step>
    <step id="250">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'events_ical_days_past'</step>
    <step id="260">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'events_ical_days_future'</step>
    <step id="270">ALTER TABLE %PREFIX%_messages_attachments ADD COLUMN msa_uuid varchar(36)</step>
    <step id="280">ALTER TABLE %PREFIX%_user_relations ADD COLUMN ure_uuid varchar(36)</step>
    <step id="290">UpdateStepsCode::updateStep50AddUuid</step>
    <step id="300" database="mysql">ALTER TABLE %PREFIX%_messages_attachments MODIFY COLUMN msa_uuid varchar(36) NOT NULL</step>
    <step id="310" database="pgsql">ALTER TABLE %PREFIX%_messages_attachments ALTER COLUMN msa_uuid SET NOT NULL</step>
    <step id="320">CREATE UNIQUE INDEX %PREFIX%_idx_msa_uuid ON %PREFIX%_messages_attachments (msa_uuid)</step>
    <step id="330" database="mysql">ALTER TABLE %PREFIX%_user_relations MODIFY COLUMN ure_uuid varchar(36) NOT NULL</step>
    <step id="340" database="pgsql">ALTER TABLE %PREFIX%_user_relations ALTER COLUMN ure_uuid SET NOT NULL</step>
    <step id="350">CREATE UNIQUE INDEX %PREFIX%_idx_ure_uuid ON %PREFIX%_user_relations (ure_uuid)</step>
    <step id="360">INSERT INTO %PREFIX%_components (com_type, com_name, com_name_intern, com_version, com_beta) VALUES ('MODULE', 'SYS_ORGANIZATION', 'ORGANIZATIONS',  '5.0.0', 0)</step>
    <step id="370">INSERT INTO %PREFIX%_menu (men_com_id, men_men_id_parent, men_uuid, men_node, men_order, men_standard, men_name_intern, men_url, men_icon, men_name, men_description)
        VALUES ((SELECT com_id FROM %PREFIX%_components WHERE com_name_intern = 'ORGANIZATIONS'), 2, %UUID%, false, 4, true, 'organization', '/adm_program/modules/organizations.php', 'diagram-3-fill', 'SYS_ORGANIZATION', 'SYS_ORGANIZATION_DESC')</step>
    <step id="380" database="mysql">ALTER TABLE %PREFIX%_organizations MODIFY COLUMN org_longname varchar(255) NOT NULL</step>
    <step id="390" database="pgsql">ALTER TABLE %PREFIX%_organizations ALTER COLUMN org_longname TYPE varchar(255)</step>
    <step id="400" database="pgsql">ALTER TABLE %PREFIX%_organizations ALTER COLUMN org_longname SET NOT NULL</step>
    <step id="410" database="mysql">ALTER TABLE %PREFIX%_organizations MODIFY COLUMN org_homepage varchar(255) NOT NULL</step>
    <step id="420" database="pgsql">ALTER TABLE %PREFIX%_organizations ALTER COLUMN org_homepage TYPE varchar(255)</step>
    <step id="430" database="pgsql">ALTER TABLE %PREFIX%_organizations ALTER COLUMN org_homepage SET NOT NULL</step>
    <step id="440">ALTER TABLE %PREFIX%_organizations ADD COLUMN org_email_administrator varchar(254)</step>
    <step id="450" database="mysql">UPDATE %PREFIX%_organizations INNER JOIN %PREFIX%_preferences ON prf_org_id = org_id SET org_email_administrator = prf_value WHERE prf_name = 'email_administrator'</step>
    <step id="460" database="pgsql">UPDATE %PREFIX%_organizations SET org_email_administrator = prf_value FROM %PREFIX%_preferences WHERE prf_org_id = org_id AND prf_name = 'email_administrator'</step>
    <step id="470">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'email_administrator'</step>
    <step id="480">ALTER TABLE %PREFIX%_organizations ADD COLUMN org_show_org_select boolean NOT NULL DEFAULT false</step>
    <step id="490" database="mysql">UPDATE %PREFIX%_organizations INNER JOIN %PREFIX%_preferences ON prf_org_id = org_id SET org_show_org_select = prf_value WHERE prf_name = 'system_organization_select'</step>
    <step id="500" database="pgsql">UPDATE %PREFIX%_organizations SET org_show_org_select = CAST(prf_value AS boolean) FROM %PREFIX%_preferences WHERE prf_org_id = org_id AND prf_name = 'system_organization_select'</step>
    <step id="510">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'system_organization_select'</step>
    <step id="520">UPDATE %PREFIX%_menu SET men_url = '/adm_program/modules/registration.php' WHERE men_name_intern = 'registration'</step>
    <step id="530">UPDATE %PREFIX%_menu SET men_url = '/adm_program/modules/preferences.php' WHERE men_name_intern = 'orgprop'</step>
    <step id="540">UPDATE %PREFIX%_menu SET men_url = '/adm_program/modules/menu.php' WHERE men_name_intern = 'menu'</step>
    <step id="550">UPDATE %PREFIX%_menu SET men_name_intern = 'extensions', men_name = 'SYS_EXTENSIONS' WHERE men_id = 3</step>
    <step id="560">CREATE TABLE %PREFIX%_forum_topics
        (
        fot_id                      integer unsigned    NOT NULL    AUTO_INCREMENT,
        fot_uuid                    varchar(36)         NOT NULL,
        fot_cat_id                  integer unsigned    NOT NULL,
        fot_fop_id_first_post            integer unsigned,
        fot_title                   varchar(255)        NOT NULL,
        fot_views                   integer             NOT NULL,
        fot_usr_id_create           integer unsigned,
        fot_timestamp_create        timestamp           NOT NULL    DEFAULT CURRENT_TIMESTAMP,
        PRIMARY KEY (fot_id)
        )
        ENGINE = InnoDB
        DEFAULT character SET = utf8
        COLLATE = utf8_unicode_ci</step>
    <step id="570">CREATE UNIQUE INDEX %PREFIX%_idx_fot_uuid ON %PREFIX%_forum_topics (fot_uuid)</step>
    <step id="580">CREATE TABLE %PREFIX%_forum_posts
        (
        fop_id                      integer unsigned    NOT NULL    AUTO_INCREMENT,
        fop_fot_id                  integer unsigned    NOT NULL,
        fop_uuid                    varchar(36)         NOT NULL,
        fop_text                    text                NOT NULL,
        fop_usr_id_create           integer unsigned,
        fop_timestamp_create        timestamp           NOT NULL    DEFAULT CURRENT_TIMESTAMP,
        fop_usr_id_change           integer unsigned,
        fop_timestamp_change        timestamp           NULL        DEFAULT NULL,
        PRIMARY KEY (fop_id)
        )
        ENGINE = InnoDB
        DEFAULT character SET = utf8
        COLLATE = utf8_unicode_ci</step>
    <step id="590">CREATE UNIQUE INDEX %PREFIX%_idx_fop_uuid ON %PREFIX%_forum_posts (fop_uuid)</step>
    <step id="600">ALTER TABLE %PREFIX%_forum_topics
        ADD CONSTRAINT %PREFIX%_fk_fot_cat         FOREIGN KEY (fot_cat_id)         REFERENCES %PREFIX%_categories (cat_id)          ON DELETE RESTRICT ON UPDATE RESTRICT,
        ADD CONSTRAINT %PREFIX%_fk_fot_first_fop   FOREIGN KEY (fot_fop_id_first_post)   REFERENCES %PREFIX%_forum_posts (fop_id)         ON DELETE RESTRICT ON UPDATE RESTRICT,
        ADD CONSTRAINT %PREFIX%_fk_fot_usr_create  FOREIGN KEY (fot_usr_id_create)  REFERENCES %PREFIX%_users (usr_id)               ON DELETE SET NULL ON UPDATE RESTRICT</step>
    <step id="610">ALTER TABLE %PREFIX%_forum_posts
        ADD CONSTRAINT %PREFIX%_fk_fop_fot         FOREIGN KEY (fop_fot_id)         REFERENCES %PREFIX%_forum_topics (fot_id)        ON DELETE RESTRICT ON UPDATE RESTRICT,
        ADD CONSTRAINT %PREFIX%_fk_fop_usr_create  FOREIGN KEY (fop_usr_id_create)  REFERENCES %PREFIX%_users (usr_id)               ON DELETE RESTRICT ON UPDATE RESTRICT,
        ADD CONSTRAINT %PREFIX%_fk_fop_usr_change  FOREIGN KEY (fop_usr_id_change)  REFERENCES %PREFIX%_users (usr_id)               ON DELETE SET NULL ON UPDATE RESTRICT</step>
    <step id="615">UpdateStepsCode::updateStep50ForumCategories</step>
    <step id="620">UPDATE %PREFIX%_components SET com_name = 'SYS_FORUM', com_name_intern = 'FORUM' WHERE com_name_intern = 'GUESTBOOK'</step>
    <step id="630">UPDATE %PREFIX%_menu SET men_name = 'SYS_FORUM', men_name_intern = 'forum', men_icon='chat-dots-fill', men_url='/adm_program/modules/forum.php', men_description='SYS_FORUM_DESC', men_men_id_parent = 1 WHERE men_name_intern = 'guestbook'</step>
    <step id="640" database="mysql">UPDATE %PREFIX%_preferences pr1 INNER JOIN %PREFIX%_preferences pr2 ON pr2.prf_name = 'enable_guestbook_module' SET pr1.prf_value = 0 WHERE pr1.prf_name = 'forum_module_enabled'</step>
    <step id="650" database="pgsql">UPDATE %PREFIX%_preferences pr1 SET prf_value = 0 FROM %PREFIX%_preferences pr2 WHERE pr2.prf_name = 'enable_guestbook_module' AND pr1.prf_name = 'forum_module_enabled'</step>
    <step id="660">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'enable_guestbook_module'</step>
    <step id="670" database="mysql">UPDATE %PREFIX%_preferences pr1 INNER JOIN %PREFIX%_preferences pr2 ON pr2.prf_name = 'guestbook_entries_per_page' SET pr1.prf_value = 25 WHERE pr1.prf_name = 'forum_topics_per_page'</step>
    <step id="680" database="pgsql">UPDATE %PREFIX%_preferences pr1 SET prf_value = 25 FROM %PREFIX%_preferences pr2 WHERE pr2.prf_name = 'guestbook_entries_per_page' AND pr1.prf_name = 'forum_topics_per_page'</step>
    <step id="690">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'guestbook_entries_per_page'</step>
    <step id="700">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'enable_guestbook_captcha'</step>
    <step id="710">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'flooding_protection_time'</step>
    <step id="720">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'enable_gbook_comments4all'</step>
    <step id="730">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'enable_intial_comments_loading'</step>
    <step id="740">DELETE FROM %PREFIX%_preferences WHERE prf_name = 'enable_guestbook_moderation'</step>
    <step id="750">ALTER TABLE %PREFIX%_roles ADD COLUMN rol_forum_admin boolean not null default false</step>
    <step id="760">UPDATE %PREFIX%_roles SET rol_forum_admin = true WHERE rol_administrator = true</step>
    <step id="770">ALTER TABLE %PREFIX%_roles DROP COLUMN rol_guestbook</step>
    <step id="780">ALTER TABLE %PREFIX%_roles DROP COLUMN rol_guestbook_comments</step>
    <step id="790" database="mysql">ALTER TABLE %PREFIX%_guestbook DROP FOREIGN KEY %PREFIX%_fk_gbo_org</step>
    <step id="800" database="pgsql">ALTER TABLE %PREFIX%_guestbook DROP CONSTRAINT %PREFIX%_fk_gbo_org</step>
    <step id="810" database="mysql">ALTER TABLE %PREFIX%_guestbook DROP FOREIGN KEY %PREFIX%_fk_gbo_usr_create</step>
    <step id="820" database="pgsql">ALTER TABLE %PREFIX%_guestbook DROP CONSTRAINT %PREFIX%_fk_gbo_usr_create</step>
    <step id="830" database="mysql">ALTER TABLE %PREFIX%_guestbook DROP FOREIGN KEY %PREFIX%_fk_gbo_usr_change</step>
    <step id="840" database="pgsql">ALTER TABLE %PREFIX%_guestbook DROP CONSTRAINT %PREFIX%_fk_gbo_usr_change</step>
    <step id="850" database="mysql">ALTER TABLE %PREFIX%_guestbook_comments DROP FOREIGN KEY %PREFIX%_fk_gbc_gbo</step>
    <step id="860" database="pgsql">ALTER TABLE %PREFIX%_guestbook_comments DROP CONSTRAINT %PREFIX%_fk_gbc_gbo</step>
    <step id="870" database="mysql">ALTER TABLE %PREFIX%_guestbook_comments DROP FOREIGN KEY %PREFIX%_fk_gbc_usr_create</step>
    <step id="880" database="pgsql">ALTER TABLE %PREFIX%_guestbook_comments DROP CONSTRAINT %PREFIX%_fk_gbc_usr_create</step>
    <step id="890" database="mysql">ALTER TABLE %PREFIX%_guestbook_comments DROP FOREIGN KEY %PREFIX%_fk_gbc_usr_change</step>
    <step id="900" database="pgsql">ALTER TABLE %PREFIX%_guestbook_comments DROP CONSTRAINT %PREFIX%_fk_gbc_usr_change</step>
    <step>stop</step>
</update>
